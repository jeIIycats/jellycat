local HttpService = game:GetService('HttpService')

return {
    Start = function(self, tasks, titleText)
        local loader = self.new(titleText)
        
        for i, taskData in ipairs(tasks) do
            if taskData.status then
                loader.SetStatus(taskData.status)
            end
            if taskData.progress then
                loader.SetProgress(taskData.progress)
            end
            if taskData.action then
                taskData.action()
            end
            task.wait(0.1)
        end

        task.wait(0.5)
        loader.Destroy()
        return true
    end,
    new = function(...)
        local titleText = ...
        local ScreenGui = Instance.new('ScreenGui')

        ScreenGui.Name = 'LoadingUI'
        ScreenGui.Parent = game:GetService('CoreGui')
        ScreenGui.Enabled = true

        local MainFrame = Instance.new('Frame')
        MainFrame.Name = 'MainFrame'
        MainFrame.Size = UDim2.new(0, 300, 0, 100)
        MainFrame.Position = UDim2.new(0.5, -150, 0.5, -50)
        MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        MainFrame.BorderSizePixel = 0
        MainFrame.Parent = ScreenGui

        local Stroke = Instance.new('UIStroke')
        Stroke.Parent = MainFrame
        Stroke.Color = Color3.fromRGB(40, 40, 40)
        Stroke.Thickness = 1

        local Title = Instance.new('TextLabel')
        Title.Name = 'Title'
        Title.Size = UDim2.new(1, 0, 0, 20)
        Title.Position = UDim2.new(0, 0, 0, 10)
        Title.BackgroundTransparency = 1
        Title.TextColor3 = Color3.fromRGB(255, 255, 255)
        Title.Text = titleText or "Loading"
        Title.Font = Enum.Font.RobotoMono
        Title.TextSize = 18
        Title.Parent = MainFrame

        local Icon = Instance.new('ImageLabel')
        Icon.Name = 'Icon'
        Icon.Parent = MainFrame
        Icon.BackgroundTransparency = 1
        Icon.Position = UDim2.new(0, 5, 0, 0)
        Icon.Size = UDim2.new(0, 45, 0, 45)
        Icon.Image = 'rbxassetid://83564290292594'
        Icon.ImageColor3 = Color3.fromRGB(255, 255, 255)

        local Status = Instance.new('TextLabel')
        Status.Name = 'Status'
        Status.Size = UDim2.new(1, 0, 0, 20)
        Status.Position = UDim2.new(0, 0, 0, 35)
        Status.BackgroundTransparency = 1
        Status.TextColor3 = Color3.fromRGB(150, 150, 150)
        Status.Text = 'Initializing...'
        Status.Font = Enum.Font.RobotoMono
        Status.TextSize = 14
        Status.Parent = MainFrame

        local ProgressBar = Instance.new('Frame')
        ProgressBar.Name = 'ProgressBar'
        ProgressBar.Size = UDim2.new(0.8, 0, 0, 15)
        ProgressBar.Position = UDim2.new(0.1, 0, 0.65, 0)
        ProgressBar.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        ProgressBar.BorderSizePixel = 0
        ProgressBar.Parent = MainFrame

        local Fill = Instance.new('Frame')
        Fill.Name = 'Fill'
        Fill.Size = UDim2.new(0, 0, 1, 0)
        Fill.BackgroundColor3 = Color3.fromRGB(255, 182, 193)
        Fill.BorderSizePixel = 0
        Fill.Parent = ProgressBar

        return {
            Show = function()
                ScreenGui.Enabled = true
            end,
            SetStatus = function(text)
                Status.Text = text
            end,
            SetProgress = function(value)
                Fill:TweenSize(UDim2.new(value, 0, 1, 0), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.2, true)
            end,
            Destroy = function()
                ScreenGui:Destroy()
            end
        }
    end,
}
